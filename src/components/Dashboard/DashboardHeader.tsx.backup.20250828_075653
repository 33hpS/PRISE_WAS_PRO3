/**
 * @file components/Dashboard/DashboardHeader.tsx
 * @description –®–∞–ø–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
 */

import React from 'react'
import { Button } from '../ui/button'
import { LogOut, Settings, User as UserIcon } from 'lucide-react'
import { Card } from '../ui/card'
import { useDashboard } from '../../context/dashboard/DashboardContext'
import { useAuth } from '../../hooks/dashboard/useUserPermissions'

// ===========================
# üé® –ö–û–ú–ü–û–ù–ï–ù–¢ –®–ê–ü–ö–ò –î–ê–®–ë–û–†–î–ê
# ===========================

export const DashboardHeader: React.FC = React.memo(() => {
  const { state, isAdmin } = useDashboard()
  const { logout } = useAuth()

  const handleLogout = async () => {
    try {
      await logout()
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error)
    }
  }

  return (
    <header className="sticky top-0 z-50 w-full border-b bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/60">
      <div className="container mx-auto px-4">
        <div className="flex h-16 items-center justify-between">
          {/* –õ–æ–≥–æ—Ç–∏–ø –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ */}
          <div className="flex items-center space-x-4">
            <div className="flex items-center space-x-2">
              <div className="flex h-8 w-8 items-center justify-center rounded-md bg-blue-600 text-white font-bold">
                W
              </div>
              <div>
                <div className="font-semibold text-gray-900">WASSER</div>
                <div className="text-xs text-gray-500">–ú–µ–±–µ–ª—å–Ω–∞—è –§–∞–±—Ä–∏–∫–∞</div>
              </div>
            </div>
          </div>

          {/* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */}
          <nav className="hidden md:flex items-center space-x-6">
            <span className="text-sm text-gray-600">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
            {isAdmin && (
              <span className="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                <Settings className="w-3 h-3 mr-1" />
                –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
              </span>
            )}
          </nav>

          {/* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –¥–µ–π—Å—Ç–≤–∏—è */}
          <div className="flex items-center space-x-4">
            {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ */}
            <Card className="px-3 py-1.5 hidden sm:flex items-center space-x-2 border-gray-200">
              <UserIcon className="w-4 h-4 text-gray-600" />
              <div className="text-xs">
                <div className="font-medium text-gray-900 truncate max-w-[120px]" title={state.user?.email || '–ì–æ—Å—Ç—å'}>
                  {state.user?.email || '–ì–æ—Å—Ç—å'}
                </div>
                <div className="text-gray-500">
                  {state.user?.role ? String(state.user.role) : 'no-role'}
                </div>
              </div>
            </Card>

            {/* –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ */}
            <Button
              variant="outline"
              onClick={handleLogout}
              className="bg-transparent hover:bg-red-50 hover:border-red-200 hover:text-red-700"
              title="–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã"
            >
              <LogOut className="w-4 h-4 mr-2" />
              <span className="hidden md:inline">–í—ã–π—Ç–∏</span>
            </Button>
          </div>
        </div>
      </div>
    </header>
  )
})

DashboardHeader.displayName = 'DashboardHeader'
