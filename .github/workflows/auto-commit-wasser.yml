name: üèóÔ∏è WASSER Auto Commit & Deploy

on:
  push:
    branches: [main, develop]
    paths:
      - 'src/**'
      - 'public/**'  
      - 'package.json'
      - '*.md'
  
  schedule:
    - cron: '0 2 * * 1' # –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 2:00
  
  workflow_dispatch:
    inputs:
      commit_message:
        description: '–°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞'
        required: false
        default: 'ü§ñ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ WASSER'
      update_dependencies:
        description: '–û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏'
        type: boolean
        default: false

env:
  NODE_VERSION: '18.x'
  PROJECT_NAME: 'WASSER-Furniture-Factory'

jobs:
  analyze-and-commit:
    name: üìä –ê–Ω–∞–ª–∏–∑ –∏ –∞–≤—Ç–æ–∫–æ–º–º–∏—Ç
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      
    steps:
      - name: üîç Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v4
        with:
          fetch-depth: 2
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: üèóÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
      
      - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        run: |
          npm ci --frozen-lockfile
          npm audit --audit-level=moderate || true
      
      - name: üî¨ TypeScript –ø—Ä–æ–≤–µ—Ä–∫–∞
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ WASSER..."
          npm run type-check
          echo "‚úÖ –¢–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã"
      
      - name: üß™ ESLint –∞–Ω–∞–ª–∏–∑
        run: |
          npm run lint || true
          echo "‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω"
      
      - name: üèóÔ∏è –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
        run: |
          echo "üèóÔ∏è –°–±–æ—Ä–∫–∞ –º–µ–±–µ–ª—å–Ω–æ–π —Ñ–∞–±—Ä–∏–∫–∏ WASSER..."
          npm run build
          echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
      
      - name: üìä –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫
        run: |
          npm run metrics || true
          echo "‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±—Ä–∞–Ω—ã"
      
      - name: ü§ñ –£–º–Ω—ã–π –∞–≤—Ç–æ–∫–æ–º–º–∏—Ç WASSER
        run: |
          git config --local user.email "wasser-bot@github-actions"
          git config --local user.name "WASSER AutoCommit Bot üèóÔ∏è"
          
          # –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ –∏ –∞–≤—Ç–æ–∫–æ–º–º–∏—Ç–∞
          npm run wasser:commit || echo "‚ö†Ô∏è –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∞–≤—Ç–æ–∫–æ–º–º–∏—Ç–∞"
      
      - name: üöÄ Push –∏–∑–º–µ–Ω–µ–Ω–∏–π
        run: |
          git push origin ${{ github.ref_name }} || echo "‚ö†Ô∏è –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è push"
